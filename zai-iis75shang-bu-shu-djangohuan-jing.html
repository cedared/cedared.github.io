<!DOCTYPE html>
<html lang="zh">
<head>
        <meta charset="utf-8" />
        <title>在iis7.5上部署Django环境</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Just Be Free! </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/misc.html">misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/zai-iis75shang-bu-shu-djangohuan-jing.html" rel="bookmark"
           title="Permalink to 在iis7.5上部署Django环境">在iis7.5上部署Django环境</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-04-03T00:38:21">
                四 03 四月 2014
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/albert-young.html">Albert Young</a>
        </address>
<p>In <a href="/category/misc.html">misc</a>. </p>

</footer><!-- /.post-info -->      <blockquote>
  <p>终于还是在再一次vps搬家的时候补上了 iis的django配置.又折磨了自己小两天才搞定,这次一定要记住</p>
</blockquote>

<h2 id="">一.安装环境及数据库</h2>

<p>这部分没啥可说,直接用web Platform installer安装相应内容就好,具体要安装的内容如下:</p>

<ol>
<li>python</li>
<li>django</li>
<li>mysql</li>
<li>php</li>
<li>python fastcgi 网关</li>
<li>以上为必装,其他的自己研究就好</li>
</ol>

<h2 id="_fastcgi">二. 配置fastcgi</h2>

<p>以下操作需要在cmd中进行</p>

<ol>
<li><p>安装iis的fastcgi扩展</p>

<pre><code>start /wait %windir%\System32\\PkgMgr.exe /iu:IIS-WebServerRole;IIS-WebServer;IIS-CommonHttpFeatures;IIS-StaticContent;IIS-DefaultDocument;IIS-DirectoryBrowsing;IIS-HttpErrors;IIS-HealthAndDiagnostics;IIS-HttpLogging;IIS-LoggingLibraries;IIS-RequestMonitor;IIS-Security;IIS-RequestFiltering;IIS-HttpCompressionStatic;IIS-WebServerManagementTools;IIS-ManagementConsole;WAS-WindowsActivationService;WAS-ProcessModel;WAS-NetFxEnvironment;WAS-ConfigurationAPI;IIS-CGI
</code></pre></li>
<li><p>设置python fastcgi相关配置</p>

<pre><code>%windir%\system32\inetsrv\appcmd set config /section:system.webServer/fastCGI "/+[fullPath='c:\Python27\python.exe', arguments='C:\Python27\Scripts\wfastcgi.py']"
</code></pre></li>
<li><p>设置网站配置</p>

<pre><code>%windir%\system32\inetsrv\appcmd set config /section:system.webServer/handlers "/+[name='Python_via_FastCGI',path='*',verb='*',modules='FastCgiModule',scriptProcessor='c:\Python27\python.exe|C:\Python27\Scripts\wfastcgi.py',resourceType='Unspecified']"
</code></pre></li>
<li><p>django程序运行配置</p>

<pre><code>%windir%\system32\inetsrv\appcmd.exe set config -section:system.webServer/fastCgi /+"[fullPath='C:\Python27\python.exe', arguments='C:\Python27\Scripts\wfastcgi.py'].environmentVariables.[name='DJANGO_SETTINGS_MODULE',value='DjangoApplication.settings']" /commit:apphost
注意 environment后边的配置要根据自己站点更改
</code></pre></li>
<li><p>配置Django环境变量 </p>

<pre><code>%windir%\system32\inetsrv\appcmd.exe set config -section:system.webServer/fastCgi /+"[fullPath='C:\Python27\python.exe', arguments='C:\Python27\Scripts\wfastcgi.py'].environmentVariables.[name='PYTHONPATH',value='C:\inetpub\wwwroot\DjangoApplication']" /commit:apphost
注意 environment后边的配置要根据自己站点更改
</code></pre></li>
<li><p>配置fastcgi</p>

<pre><code>%windir%\system32\inetsrv\appcmd.exe set config -section:system.webServer/fastCgi /+"[fullPath='C:\Python27\python.exe', arguments='C:\Python27\Scripts\wfastcgi.py'].environmentVariables.[name='WSGI_HANDLER',value='django.core.handlers.wsgi.WSGIHandler()']" /commit:apphost
</code></pre></li>
<li><p>配置iis
    在iis主配置中选择fastcgi设置,右键python项目点击编辑,监视对文件所做的更改-定位到djangosite下的settings.py文件
    环境变量下 pythonpath 定位到settings.py上一级目录
done!</p></li>
</ol>

<h2 id="_">三. 站点配置部分</h2>

<p>配置过python环境之后,由于django无默认文件,所以直接默认识别站点文件夹,也就导致了该服务器上的其他站点都是默认使用python进行程序处理,为了解决这个问题,我们可以在iis配置-站点配置-处理程序映射-查看已排序的列表 中调整程序映射的优先级.</p>

<hr />

<p>以上 应该就可以了.</p>

<blockquote>
  <p>环境为Windows server 2008 r2 ;iis 7.5; windows webPlatform installer 4.6 python 2.7.2 django 1.4 </p>
</blockquote>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>